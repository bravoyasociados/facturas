<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Invoice PWA</title>

<link rel="manifest" href="data:application/json,{
  &quot;name&quot;:&quot;Invoice PWA&quot;,
  &quot;short_name&quot;:&quot;Invoice&quot;,
  &quot;display&quot;:&quot;standalone&quot;
}">

<style>
:root {
  --bg: #f2f2f7;
  --card: #ffffff;
  --text: #000;
}
@media (prefers-color-scheme: dark) {
  :root {
    --bg: #000;
    --card: #1c1c1e;
    --text: #fff;
  }
}
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont;
  background: var(--bg);
  color: var(--text);
}
.screen {
  display: none;
  padding: 30px;
}
.screen.active {
  display: block;
}
.card {
  background: var(--card);
  border-radius: 16px;
  padding: 20px;
}
input, button {
  width: 100%;
  padding: 14px;
  border-radius: 12px;
  border: none;
  margin-top: 10px;
  font-size: 16px;
}
button {
  background: #007aff;
  color: #fff;
}
.logo {
  text-align: center;
  margin-bottom: 20px;
}
.logo img {
  max-height: 80px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="screen active">
  <div class="logo">
    <img src="logotipo.jpg" alt="Logotipo">
  </div>
  <div class="card">
    <h2>Acceso</h2>
    <input type="password" id="pin" placeholder="Código">
    <button onclick="login()">Entrar</button>
  </div>
</div>

<!-- APP -->
<div id="app" class="screen">
  <div class="logo">
    <img src="logotipo.jpg" alt="Logotipo">
  </div>
  <div class="card">
    <h2>Invoice PWA</h2>
    <p>Aplicación lista para pruebas.</p>
    <button onclick="logout()">Cerrar sesión</button>
  </div>
</div>

<script>
const PIN = "28053";

function show(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function login() {
  const pin = document.getElementById('pin').value;

  if (!localStorage.getItem("registered")) {
    if (pin === PIN) {
      localStorage.setItem("registered", "true");
      registerBiometric();
      show("app");
    } else {
      alert("Código incorrecto");
    }
  } else {
    if (pin === PIN) {
      show("app");
    } else {
      authenticateBiometric();
    }
  }
}

function logout() {
  show("login");
}

async function registerBiometric() {
  if (!window.PublicKeyCredential) return;

  try {
    await navigator.credentials.create({
      publicKey: {
        challenge: new Uint8Array(32),
        rp: { name: "Invoice PWA" },
        user: {
          id: new Uint8Array(16),
          name: "usuario",
          displayName: "Usuario"
        },
        pubKeyCredParams: [{ type: "public-key", alg: -7 }],
        authenticatorSelection: {
          authenticatorAttachment: "platform",
          userVerification: "required"
        }
      }
    });
    localStorage.setItem("biometric", "true");
  } catch (e) {
    console.warn("Biometría no registrada");
  }
}

async function authenticateBiometric() {
  if (!window.PublicKeyCredential || !localStorage.getItem("biometric")) {
    alert("Ingresa el código");
    return;
  }

  try {
    await navigator.credentials.get({
      publicKey: {
        challenge: new Uint8Array(32),
        userVerification: "required"
      }
    });
    show("app");
  } catch {
    alert("Autenticación cancelada");
  }
}
</script>

</body>
</html>
