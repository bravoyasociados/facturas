<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Invoice iOS Pro</title>
<meta name="theme-color" content="#007aff">

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
:root{
--bg:#f2f2f7;--card:rgba(255,255,255,.75);
--text:#1c1c1e;--primary:#007aff;
}
@media (prefers-color-scheme: dark){
:root{
--bg:#000;--card:rgba(28,28,30,.75);
--text:#f2f2f7;
}}
body{
margin:0;background:var(--bg);
font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display";
color:var(--text);
}
.hidden{display:none}
.app{max-width:900px;margin:auto;padding:20px}
.card{
background:var(--card);backdrop-filter:blur(25px);
border-radius:22px;padding:20px;margin-bottom:20px;
}
button{
width:100%;padding:14px;border-radius:16px;
border:none;background:var(--primary);color:#fff;
font-size:16px;
}
input,select{
width:100%;padding:12px;border-radius:14px;
border:1px solid #ccc;margin:6px 0;
}
.lock{
height:100vh;display:flex;
flex-direction:column;
align-items:center;justify-content:center;
text-align:center;
}
.logo img{max-height:80px}
</style>
</head>

<body>

<!-- BLOQUEO -->
<div id="lock" class="lock">
<div class="logo">
<img src="logotipo.jpeg">
</div>
<h2>Invoice iOS</h2>
<p id="lockText">Autenticación requerida</p>
<button onclick="auth()">Continuar con Face ID</button>
</div>

<!-- APP -->
<div id="app" class="app hidden">
<h2>Invoice iOS Pro</h2>
<div class="card">
<p>Acceso concedido correctamente</p>
<button onclick="pdf()">Probar PDF</button>
</div>
</div>

<script>
const credKey = "invoice_passkey";

/* UTIL */
function buf(b){return Uint8Array.from(b, c => c.charCodeAt(0))}
function rand(n=32){return crypto.getRandomValues(new Uint8Array(n))}

/* AUTENTICACIÓN FACE ID REAL */
async function auth(){
if(!window.PublicKeyCredential){
alert("Tu navegador no soporta Face ID web");
return;
}

const stored = localStorage.getItem(credKey);

try{
if(!stored){
/* REGISTRO PASSKEY */
document.getElementById("lockText").innerText="Registrando Face ID…";

const cred = await navigator.credentials.create({
publicKey:{
challenge: rand(),
rp:{name:"Invoice iOS"},
user:{
id: rand(),
name:"usuario@local",
displayName:"Usuario Invoice"
},
pubKeyCredParams:[{type:"public-key",alg:-7}],
authenticatorSelection:{
authenticatorAttachment:"platform",
userVerification:"required"
},
timeout:60000,
attestation:"none"
}
});

localStorage.setItem(credKey,"true");
}

/* LOGIN FACE ID */
document.getElementById("lockText").innerText="Verificando Face ID…";

await navigator.credentials.get({
publicKey:{
challenge: rand(),
userVerification:"required",
timeout:60000
}
});

/* ACCESO */
lock.classList.add("hidden");
app.classList.remove("hidden");

}catch(e){
alert("Autenticación cancelada o fallida");
console.error(e);
}
}

/* DEMO */
function pdf(){
html2pdf().from(document.body).save("demo.pdf");
}
</script>

</body>
</html>
